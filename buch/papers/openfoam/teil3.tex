%
% teil3.tex -- Beispiel-File für Teil 3
%
% (c) 2020 Prof Dr Andreas Müller, Hochschule Rapperswil
%
% !TEX root = ../../buch.tex
% !TEX encoding = UTF-8
%
\section{Anwendungsbeispiel
\label{openfoam:section:Anwendungsbeispiel}}
\kopfrechts{Anwendungsbeispiel}
Wie wir gesehen haben, kann OpenFOAM, mit genügend können und geduld, sehr viel.

Wir werden jetzt an einem praktischen Beispiel zeigen, wie man eine eigene Simulation erstellt.

Für ein anschauliches Beispiel haben wir ein Objekt gewählt, dass alle Studenten der OST-Rapperswil kennen: den Campus Rapperswil.
Das Ziel der Simulation ist, zu sehen, wie der Wind um die Gebäude strömt und mit ihnen interagiert, das Bild auch dem Buchumschlag wird das Resulatat sein.

%Übersicht Kapitel -----------------------------------------------------------------------------------------
\subsection{Übersicht \label{openfoam:section:Übersicht}}
Wir besitzten ein 3D-Objekt, im Beispiel im Massstab 1/1.
Um die Simulation durchfüren zu können benötigen wir eine Simulationsumgebung, eine grosse Box die den Campus umschliesst.
Es wird auch definiert wie sich die Flächen dieser Box verhalten sollen, Eingang, Ausgang oder Wand 
mit oder ohne Einfluss aus die innere Strömung.
Diese Box wird dann in viele einzelne Zellen aufgeteilt.
In der Simulation wird für jede Zelle, für jeden Zeitschritt, 
die nötigen Differentialgleichungen für die lokalen Informationen gerechnet.
Das Ergebniss kann dann mit einem Auswertungstool angesehen und ausgewertet werden.

OpenFOAM arbeitet für jede Simulation mit einem sogenannten \texttt{Case}-Ordner (Abb. \ref{fig:ordStrktSim}). 
Darin sind alle Parameter, 3D-Objekte und Anfangsbedingungen abgelegt.
Nach der Simulation sind hier die Zeitverzeichnisse abgelegt.

\begin{center}
        OpenFOAM arbeitet mit SI-Einheiten, alle Werte müssen in Meter und Sekunden angegeben werden.
\end{center}

\begin{figure}
    \centering
    \includegraphics[width=0.55\textwidth]{papers/openfoam/Bilder/Ordnerstruktur_Simuliert.jpg}
    \caption{Ordnerstruktur nach der Simulation, 0,5...60 die Zeitpunkte die in Paraview dargestellt werden können.}
    \label{fig:ordStrktSim}
\end{figure}


%Vorbereitung Kapitel --------------------------------------------------------------------------------------
\subsection{Vorbereitung \label{openfoam:section:Vorbereitung}}
\begin{itemize}
    \item Vor der Simulation muss entschieden werden was überhaupt simuliert werden möchte und welche Gleichungen dafür infrage kommen.
Zum Beispiel die Navier-Stokes-Gleichungen, Large-Eddy Simulation (LES) oder auch solche für Wärmeübertragung.
    \item Es muss die Geometrie der Umgebung definiert werden, gibt es möglichkeiten Symmetrien auszunutzen um den Rechenaufwand zu minimieren?
    \item Die Randbedingungen müssen festgelegt werden, wo strömt das Fluid in die Geometrie ein, wo verlässt es sie.
    \item Wie verhalten sich die Wände, tragen sie zu Turbulenzen bei oder nicht.
    \item Sind die Wände genug weit vom Objekt entfernt, dass ihr Einfluss auf das Ergebniss vernachlässigbar ist?
\end{itemize} 

Diese Überlegungen sind essenziell um ein realistisches und stabiles Simulationsmodell aufzubauen.


%Mesh erstellen Kapitel ------------------------------------------------------------------------------------
\subsection{Mesh erstellen \label{openfoam:section:Mesh erstellen}}
Der grundlegende Schritt einer jeder Simulation ist, die reale, analoge Welt in eine diskrete Welt zu überführen.\\
Die Simulationsumgebung wird mit der Funktion \textbf{blockMesh} erstellt.
Im Dokument \texttt{blockMeshDict} werden die Parameter definiert:

\begin{itemize}
    \item \textit{backgroundMesh}: Beschreibt das Hintergrundgitter auf dem dann \textbf{snappyHexMesh} aufbaut.
    \item \textit{boundary}: Beschreibt die Ränder der Simulationsumgebung, weist jeder Fläche einen Namen und eine Bedingung (Eingang, Ausgang, Wand) zu
\end{itemize}

Je mehr Zellen erstellt werden, desto genauer wird das Ergebniss der Simulation.
Mit jeder Zelle steigt der Rechenaufwand.
Es muss ein Mittelweg gefunden werden, so viel wie nötig, so wenig wie möglich.\\

Um scharfe Kanten und Ecken im 3D-Objekt zu erkennen wird die Funktion \textbf{surfaceFeatureExtract} verwendet.
Diese vorarbeit hilft \textbf{snappyHexMesh} bei der Mesh-Erstellung das Gitter genauer an der Geometrie auszurichten.
Im Dokument \texttt{surfaceFeatureExtractDict} werden die Parameter definiert:

\begin{itemize}
    \item \textit{Name des 3D-Objekt}: Von wo die Features extrahiert werden sollen.
    \item \textit{includedAngle}: Winkel ab welchem eine Kante als scharf gilt und extrahiert wird.
\end{itemize}

Mithilfe der Funktion \textbf{snappyHexMesh} wird das 3D-Objekt selbst in  Zellen unterteilt und in der Simulationsumgebung eingefügt. 
Im Dokument \texttt{snappyHexMeshDict} werden die Parameter definiert:

\begin{itemize}
    \item \textit{geometry}: Definition des 3D-Objekt, z.b. in Form einer STL-Datei.
    \item \textit{castellatedMeshControls}: Erste Stufe des Meshing, steuert wie die Quader am anfang angenähert werden.
    \item \textit{snapControls}: Wie oft das Mesh verfeinert wird. 
    In einem ersten Durchlauf wird das 3D-Objekt grob in Quader aufgeteilt (Abb. \ref{fig:snappygrobbild}),
    in den folgenden Schritten wird die Annäherung an die Vorgabe immer besser (Abb. \ref{fig:snappyfeinbild}).
    Üblich sind 20 bis 40 Durchläufe, ist jedoch auch ein abwägen zwischen dem Nutzen und dem erhöhten Rechenaufwand.
    \item \textit{addLayersControls}: Im 3D-Mesh werden die Blöcke in der nähe des Objekt verkleinert, 
    damit können die interessanten Bereiche räumlich genauer Simuliert werden.
\end{itemize}

\begin{figure}
    \centering
    \includegraphics[width=0.55\textwidth]{papers/openfoam/Bilder/Snappy_grob.png}
    \caption{Mesh nach dem ersten Durchlauf von snappyHexMesh}
    \label{fig:snappygrobbild}
\end{figure}

\begin{figure}
    \centering
    \includegraphics[width=0.55\textwidth]{papers/openfoam/Bilder/Snappy_fein.png}
    \caption{Mesh nach dem zweiten Durchlauf von snappyHexMesh}
    \label{fig:snappyfeinbild}
\end{figure}

%Anfangsbedingungen Kapitel --------------------------------------------------------------------------------
\subsection{Anfangsbedingungen \label{openfoam:section:Anfangsbedingungen}}


%Simulation Kapitel ----------------------------------------------------------------------------------------
\subsection{Simulation \label{openfoam:section:Simulation}}


%Auswertung Kapitel ----------------------------------------------------------------------------------------
\subsection{Auswertung \label{openfoam:section:Auswertung}}


\begin{center}
        Modelle sind immer falsch! Somit ist jede Simulation ebenfalls falsch!
\end{center}