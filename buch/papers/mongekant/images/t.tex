%
% t.tex -- Transport eines Masses
%
% (c) 2021 Prof Dr Andreas MÃ¼ller, OST Ostschweizer Fachhochschule
%
\documentclass[tikz]{standalone}
\usepackage{amsmath}
\usepackage{times}
\usepackage{txfonts}
\usepackage{pgfplots}
\usepackage{csvsimple}
\usepackage{ifthen}
\usetikzlibrary{arrows,intersections,math,calc}
\definecolor{darkred}{rgb}{0.8,0,0}
\definecolor{redleft}{rgb}{1.0,0.2,0.4}
\definecolor{redmiddle}{rgb}{0.8,0.0,0.4}
\definecolor{redright}{rgb}{1.0,0.4,0.2}
\definecolor{darkblue}{rgb}{0,0,0.8}
\definecolor{blueleft}{rgb}{0.5,0.3,1.0}
\definecolor{bluemiddle}{rgb}{0.4,0.0,0.8}
\definecolor{blueright}{rgb}{0.3,0.5,1.0}
\begin{document}
\newboolean{withT}
\setboolean{withT}{true}
\def\skala{1}
\def\l{2.8}
\def\xmin{0.1}
\def\xmax{1.1}
\begin{tikzpicture}[>=latex,thick,scale=\skala,
declare function = {
	X(\y) = \y * (\y / \l) * (\y / \l);
	Yp(\x) = \l*exp(ln(\x/\l)/3);
	Xp(\y) = 3 * (\y/\l) * (\y/\l);
	window1(\X) = (1 - \X/\l) * (1 + \X/\l);
	window2(\X) = window1(\X) * window1(\X);
	window3(\X) = window2(\X) * window1(\X);
	window4(\X) = window3(\X) * window1(\X);
	density(\x) = 3*exp(-\x*\x/2) * window1(\x);
}]

\pgfmathparse{Yp(\xmax)}
\xdef\ymax{\pgfmathresult}
\pgfmathparse{Yp(\xmin)}
\xdef\ymin{\pgfmathresult}
\def\oben{3.8}
\def\rechts{6.4}

\ifthenelse{\boolean{withT}}{
\begin{scope}[xshift=-3.2cm,yshift=-3.8cm]
	\draw[->] ({-\l-0.1},-\l) -- ({\l+0.4},-\l)
		coordinate[label={$x$}];
	\draw[->] (-\l,{-\l-0.1}) -- (-\l,{\l+0.4})
		coordinate[label={right:$y=T(x)$}];

	\fill[color=blueleft!40,opacity=0.5] (-\xmax,-\ymax)
		-- ({-\ymax+\rechts},-\ymax) 
		-- ({-\ymin+\rechts},-\ymin)
		-- (-\xmax,-\ymin)
		-- cycle;
	\fill[color=blueleft!40,opacity=0.5] ({-\ymax+\rechts},-\ymax) 
		-- ({-\ymin+\rechts},-\ymin)
		-- ({-\ymin+\rechts},\oben)
		-- ({-\ymax+\rechts},\oben)
		-- cycle;

	\fill[color=bluemiddle!40,opacity=0.5] (-\xmin,-\ymin)
		-- ({-\ymin+\rechts},-\ymin) 
		-- ({\ymin+\rechts},\ymin)
		-- (-\xmin,\ymin)
		-- cycle;
	\fill[color=bluemiddle!40,opacity=0.5] ({-\ymin+\rechts},-\ymin) 
		-- ({\ymin+\rechts},\ymin)
		-- ({\ymin+\rechts},\oben)
		-- ({-\ymin+\rechts},\oben)
		-- cycle;

	\fill[color=blueright!40,opacity=0.5] (\xmin,\ymin)
		-- ({\ymin+\rechts},\ymin) 
		-- ({\ymax+\rechts},\ymax)
		-- (\xmin,\ymax)
		-- cycle;
	\fill[color=blueright!40,opacity=0.5] ({\ymin+\rechts},\ymin) 
		-- ({\ymax+\rechts},\ymax)
		-- ({\ymax+\rechts},\oben)
		-- ({\ymin+\rechts},\oben)
		-- cycle;

	\fill[color=redleft!20] (-\xmax,\oben)
		-- plot[domain=-\ymax:-\ymin,samples=40] ({X(\x)},{\x})
		-- (-\xmin,\oben) -- cycle;
	\fill[color=redmiddle!20] (-\xmin,\oben)
		-- plot[domain=-\ymin:\ymin,samples=40] ({X(\x)},{\x})
		-- (\xmin,\oben) -- cycle;
	\fill[color=redright!20] (\xmin,\oben)
		-- plot[domain=\ymin:\ymax,samples=40] ({X(\x)},{\x})
		-- (\xmax,\oben) -- cycle;

	\draw[line width=1.4pt] plot[domain=-\l:\l,samples=100]
		({X(\x)},{\x});

	\node at ({-\xmax-0.03},{-0.5*(\ymin+\ymax)}) [right]
		{${\color{redleft}A_1}=\{x\mid T(x)\in {\color{blueleft}B_1}\}$};

	\node at (-0.5,0) [right]
		{${\color{redmiddle}A_2}=\{x\mid T(x)\in {\color{bluemiddle}B_2}\}$};

	\node at ({\xmin-0.1},{0.5*(\ymin+\ymax)+0.28}) [right]
		{${\color{redright}A_3}=\{x\mid T(x)\in {\color{blueright}B_3}\}$};
	\draw[line width=0.2pt] ({-\l+\rechts},-\l) -- ({\l+\rechts},\l);
	\node at (\rechts,0) [below,rotate=45] {``$y = x$''};
\end{scope}}{}

\begin{scope}[xshift=-3.2cm]
	\fill[color=darkred!10] plot[domain=-\l:\l,samples=100]
		({\x},{density(\x)});

	\fill[color=redleft] (-\xmax,0)
		-- plot[domain=-\xmax:-\xmin,samples=40] ({\x},{density(\x)})
		-- (-\xmin,0) -- cycle;
	\node[color=redleft] at ({-0.5*(\xmin+\xmax)},0) [below] {$A_1$};
	\node[color=white] at ({-0.5*(\xmin+\xmax)},1.0) {$\mu(A_1)$};

	\fill[color=redmiddle] (-\xmin,0)
		-- plot[domain=-\xmin:\xmin,samples=40] ({\x},{density(\x)})
		-- (\xmin,0) -- cycle;
	\node[color=redmiddle] at (0,0) [below] {$A_2$};

	\fill[color=redright] (\xmin,0)
		-- plot[domain=\xmin:\xmax,samples=40] ({\x},{density(\x)})
		-- (\xmax,0) -- cycle;
	\node[color=redright] at ({0.5*(\xmin+\xmax)},0) [below] {$A_3$};
	\node[color=white] at ({0.5*(\xmin+\xmax)},1.0) {$\mu(A_3)$};

	\draw[line width=0.2pt,color=darkred] plot[domain=-\l:\l,samples=100]
		({\x},{density(\x)});
	\draw[->] (-3,0) -- (3,0) coordinate[label={$x$}];
	\node[darkred] at (-2.0,2.7) {$\mu(x)\mathstrut$};

	\ifthenelse{\boolean{withT}}{}{
		\node at (3,0) [below] {$A_k=\{x\mid T(x)\in B_k\}\mathstrut$};
	}
\end{scope}

\draw[->] ($(-0.8,0)+(110:2)$) arc (110:70:3);
\node at (-0.4,2.1) [above] {$T$};

\begin{scope}[xshift=3.2cm]
	\fill[color=blue!10] plot[domain=-\l:\l,samples=100]
		({\x},{density(X(\x))*Xp(\x)});

	\fill[color=blueleft] ({-\ymax},0)
		-- plot[domain=-\ymax:-\ymin,samples=40]
			({\x},{density(X(\x))*Xp(\x)})
		-- ({-\ymin},0) -- cycle;
	\node[color=blueleft] at ({-0.5*(\ymin+\ymax)},0) [below] {$B_1$};
	\node[color=white] at ({-0.5*(\ymin+\ymax)},1) {$\nu(B_1)$};


	\fill[color=bluemiddle] ({-\ymin},0)
		-- plot[domain=-\ymin:\ymin,samples=40]
			({\x},{density(X(\x))*Xp(\x)})
		-- ({\ymin},0) -- cycle;
	\node[color=bluemiddle] at (0,0) [below] {$B_2$};
	\node[color=bluemiddle] at (0,1) {$\nu(B_2)$};
	\draw[color=bluemiddle,line width=0.4pt] ({-0.5*\ymin},0.2) -- (0,0.8);
	\draw[color=bluemiddle,line width=0.4pt] ({0.5*\ymin},0.2) -- (0,0.8);

	\fill[color=blueright] ({\ymin},0)
		-- plot[domain=\ymin:\ymax,samples=40]
			({\x},{density(X(\x))*Xp(\x)})
		-- ({\ymax},0) -- cycle;
	\node[color=blueright] at ({0.5*(\ymin+\ymax)},0) [below] {$B_3$};
	\node[color=white] at ({0.5*(\ymin+\ymax)},1) {$\nu(B_3)$};

	\draw[line width=0.2pt,color=darkblue] plot[domain=-\l:\l,samples=100]
		({\x},{density(X(\x))*Xp(\x)});
	\draw[->] (-3,0) -- (3,0) coordinate[label={$y$}];
	\node[darkblue] at (2.4,2.7) {$\nu(y)\mathstrut$};
\end{scope}

\end{tikzpicture}
\end{document}

